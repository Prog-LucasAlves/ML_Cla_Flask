<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - Diabetes Prediction</title>
         <link rel="stylesheet" href="{{ url_for('static', filename='dash.css') }}">
         <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
         <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="dashboard-header">
                <h1><i class="fas fa-chart-line"></i> Dashboard de Estatísticas</h1>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total de Predições</div>
                    <div class="stat-number">{{ stats[0][0] }}</div>
                </div>

                 <div class="stat-card">
                    <div class="stat-label">Casos Positivos ({{ positive_rate }}%)</div>
                    <div class="stat-number stat-positive">{{ stats[0][1] }}</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Casos Negativos ({{ negative_rate }}%)</div>
                    <div class="stat-number stat-negative">{{ stats[0][2] }}</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Probabilidade Média</div>
                    <div class="stat-number">{{ "%.2f"|format(stats[0][3] * 100) }}%</div>
                </div>
            </div>

            <!-- Tab: Visão Geral -->
            <div id="tab-overview" class="tab-content active">
                <div class="grid-2">
                    <div class="chart-container">
                        <div class="chart-title">Distribuição de Resultados</div>
                        <canvas id="predictionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Distribuição por Gênero</div>
                        <canvas id="genderChart" ></canvas>
                    </div>
                </div>
            </div>

            <div id="tab-distribution" class="tab-content">
                <div class="grid-3">
                    <div class="chart-container">
                        <div class="chart-title">Distribuição Por Faixa Etária</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Faixa Etária</th>
                                    <th>Quantidade</th>
                                    <th>Percentual</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for group, count, percentage in age_distribution %}
                                <tr>
                                    <td>{{ group }}</td>
                                    <td>{{ count }}</td>
                                    <td>{{ percentage }}%</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Distribuição por Histórico de Tabagismo</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tabagismo</th>
                                    <th>Total</th>
                                    <th>Diabetes</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for history, count, percentage, positive, avg_prob in smoking_distribution %}
                                <tr>
                                    <td>
                                        {% if history == 'No Info' %}Sem Informação
                                        {% elif history == 'never' %}Nunca fumou
                                        {% elif history == 'ever' %}Já fumou(Alguma Vez)
                                        {% elif history == 'former' %}Ex-fumante
                                        {% elif history == 'not current' %}Não fumante atual
                                        {% elif history == 'current' %}Fumante atual
                                        {% else %}{{ history }}{% endif %}
                                    </td>
                                    <td>{{ count }}</td>
                                    <td>{{ positive }} ({{ "%.1f"|format((positive/count)*100 if count > 0 else 0) }}%)</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>

        <!-- Tab: Fatores de Risco -->
        <div id="tab-risk" class="tab-content">
            <div class="grid-3">
                <div class="chart-container-d">
                    <div class="chart-title">Idade Média</div>
                    <div class="risk-factor risk-factor-positive">
                        <span>Casos Positivos:</span>
                        <strong>{{ "%.1f"|format(risk_factors[0]) }} anos</strong>
                    </div>
                    <div class="risk-factor risk-factor-negative">
                        <span>Casos Negativos:</span>
                        <strong>{{ "%.1f"|format(risk_factors[1]) }} anos</strong>
                    </div>
                </div>

                <div class="chart-container-d">
                    <div class="chart-title">IMC Médio</div>
                    <div class="risk-factor risk-factor-positive">
                        <span>Casos Positivos:</span>
                        <strong>{{ "%.2f"|format(risk_factors[2]) }}</strong>
                    </div>
                    <div class="risk-factor risk-factor-negative">
                        <span>Casos Negativos:</span>
                        <strong>{{ "%.2f"|format(risk_factors[3]) }}</strong>
                    </div>
                </div>

                <div class="chart-container-d">
                    <div class="chart-title">Nível de HbA1c Médio</div>
                    <div class="risk-factor risk-factor-positive">
                        <span>Casos Positivos:</span>
                        <strong>{{ "%.1f"|format(risk_factors[4]) }}</strong>
                    </div>
                    <div class="risk-factor risk-factor-negative">
                        <span>Casos Negativos:</span>
                        <strong>{{ "%.1f"|format(risk_factors[5]) }}</strong>
                    </div>
                </div>

                <div class="chart-container-d">
                    <div class="chart-title">Nível de Glicemia Médio</div>
                    <div class="risk-factor risk-factor-positive">
                        <span>Casos Positivos:</span>
                        <strong>{{ "%.0f"|format(risk_factors[6]) }}</strong>
                    </div>
                    <div class="risk-factor risk-factor-negative">
                        <span>Casos Negativos:</span>
                        <strong>{{ "%.0f"|format(risk_factors[7]) }}</strong>
                    </div>
                </div>
            </div>

            <div class="grid-4">
                <div class="chart-container-c">
                    <div class="chart-title">Taxa de Diabetes por Hipertensão</div>
                    <div class="bar-chart-container-c">
                        <div class="bar-item">
                            <div class="bar-label">
                                <span>Com Hipertensão</span>
                                <span class="bar-value highlight-positive">{{ "%.2f"|format(hypertension_distribution[1][3]) }}% |</span>
                                <span class="bar-value-pac">{{ "%.0f"|format(hypertension_distribution[1][2]) }} de {{ "%.0f"|format(hypertension_distribution[1][1]) }} Pacientes</span>
                            </div>
                        </div>

                        <div class="bar-item">
                            <div class="bar-label">
                                <span>Sem Hipertensão</span>
                                <span class="bar-value highlight-negative">{{ "%.2f"|format(hypertension_distribution[0][3]) }}% |</span>
                                <span class="bar-value-pac">{{ "%.0f"|format(hypertension_distribution[0][2]) }} de {{ "%.0f"|format(hypertension_distribution[0][1]) }} Pacientes</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-container-c">
                    <div class="chart-title">Taxa de Diabetes por Doença Cardíaca</div>
                    <div class="bar-chart-container-c">
                        <div class="bar-item">
                            <div class="bar-label">
                                <span>Com Doença Cardíaca</span>
                                <span class="bar-value highlight-positive">{{ "%.2f"|format(heart_disease_distribution[1][3]) }}% |</span>
                                <span class="bar-value-pac">{{ "%.0f"|format(heart_disease_distribution[1][2]) }} de {{ "%.0f"|format(heart_disease_distribution[1][1]) }} Pacientes</span>
                            </div>
                        </div>

                        <div class="bar-item">
                            <div class="bar-label">
                                <span>Sem Doença Cardíaca</span>
                                <span class="bar-value highlight-negative">{{ "%.2f"|format(heart_disease_distribution[0][3]) }}% |</span>
                                <span class="bar-value-pac">{{ "%.0f"|format(heart_disease_distribution[0][2]) }} de {{ "%.0f"|format(heart_disease_distribution[0][1]) }} Pacientes</span>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>



        <script>

            // Gráfico de distribuição de resultados
            const predictionCtx = document.getElementById('predictionChart').getContext('2d');
            new Chart(predictionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Negativo', 'Positivo'],
                    datasets: [{
                        data: [{{ stats[0][2] }}, {{ stats[0][1] }}],
                        backgroundColor: ['#28a745', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });

            // Gráfico de distribuição por gênero
            const genderCtx = document.getElementById('genderChart').getContext('2d')
            new Chart(genderCtx, {
                type: 'pie',
                data: {
                    labels: [
                        {% for gender, count, percentage in gender_distribution %}
                            '{{ gender }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        data: [{% for gender, count, percentage in gender_distribution %}
                        {{ count }}, {% endfor %}],
                        backgroundColor: ['#667eea', '#f093fb', '#f5576c', '#4facfe']
                    }]
                },
                options: {
                    responsive: true,
                    pliguins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        </script>
    </body>
</html>
